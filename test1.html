<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>장애인 접근성 체크리스트 대시보드</title>
    <!-- Plotly.js 라이브러리 (v2.35.2) -->
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <style>
        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }
        p.subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .chart-section-title {
            margin-top: 50px;
            margin-bottom: 20px;
            padding-left: 10px;
            border-left: 5px solid #5C6BC0;
            font-size: 1.5em;
            color: #333;
            font-weight: bold;
        }
        .chart-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        .chart-box {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            flex: 1;
            min-width: 300px;
            min-height: 450px;
        }
        .full-width {
            flex-basis: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>📊 장애인 접근성 체크리스트 분석 결과</h1>
        <p class="subtitle">기본 분석 및 심화 데이터 시각화 (전처리 완료 데이터)</p>

        <!-- 섹션 1: 기본 현황 -->
        <div class="chart-section-title">1. 기본 현황 분석</div>
        <div class="chart-row">
            <div id="barChart" class="chart-box"></div>
            <div id="pieChart" class="chart-box"></div>
        </div>

        <!-- 섹션 2: 상세 분포 및 관계 -->
        <div class="chart-section-title">2. 항목과 상태의 관계 (심화)</div>
        <div class="chart-row">
            <!-- 선버스트 차트 -->
            <div id="sunburstChart" class="chart-box"></div>
            <!-- 히트맵 -->
            <div id="heatmapChart" class="chart-box"></div>
        </div>

        <div class="chart-row">
            <div id="groupedBarChart" class="chart-box full-width"></div>
        </div>

        <!-- 섹션 3: 수치 데이터 상세 분석 -->
        <div class="chart-section-title">3. 측정 수치 정밀 분석</div>
        <div class="chart-row">
            <!-- 히스토그램 -->
            <div id="histogramM" class="chart-box full-width"></div>
        </div>
        
        <div class="chart-row">
            <div id="boxChartM" class="chart-box"></div>
            <div id="boxChartCm" class="chart-box"></div>
        </div>

         <div class="chart-row">
            <div id="boxChartDeg" class="chart-box full-width"></div>
        </div>
    </div>

    <script>
        // ==========================================
        // 1. 데이터 정의 (전처리 완료된 데이터 반영)
        // ==========================================
        
        // [수정됨] 차트 1: 항목별 개수 (실제 데이터 반영)
        var barX = ["유효폭", "건물 진입로", "점자블록", "기울기/단차", "포장상태"];
        var barY = [62, 43, 28, 24, 9];

        // [수정됨] 차트 2: 전체 상태 비율 (실제 데이터 반영)
        var pieLabels = ["양호", "개선(장기)", "긴급조치", "긴급 조치"];
        var pieValues = [117, 33, 13, 3];

        // [수정됨] 차트 3: 상태별 항목 분포 (실제 데이터 반영)
        var groupedData = {
            "양호": {"x": ["유효폭", "점자블록", "건물 진입로", "기울기/단차", "포장상태"], "y": [56, 24, 19, 14, 4]},
            "개선(장기)": {"x": ["건물 진입로", "기울기/단차", "점자블록"], "y": [23, 8, 2]},
            "긴급조치": {"x": ["유효폭", "포장상태", "점자블록", "기울기/단차", "건물 진입로"], "y": [5, 4, 2, 1, 1]},
            "긴급 조치": {"x": ["유효폭", "기울기/단차", "포장상태"], "y": [1, 1, 1]}
        };

        // [수정됨] 박스플롯용 데이터 (전처리로 추출된 수치값)
        // (m 단위 데이터 - 유효폭 등이 포함됨)
        var boxMX = ["유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "건물 진입로", "건물 진입로", "유효폭", "유효폭", "유효폭", "건물 진입로", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "건물 진입로", "유효폭", "건물 진입로", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "건물 진입로", "건물 진입로", "건물 진입로", "건물 진입로", "유효폭", "유효폭", "유효폭", "유효폭", "건물 진입로", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "유효폭", "건물 진입로", "유효폭"];
        var boxMY = [3.6, 2.4, 1.5, 1.2, 9.0, 3.7, 2.3, 2.3, 1.9, 3.4, 2.9, 1.5, 1.5, 4.3, 1.5, 1.9, 2.2, 4.5, 1.5, 1.5, 3.6, 2.0, 10.0, 0.9, 1.4, 1.3, 1.4, 1.6, 1.5, 1.5, 4.5, 3.7, 1.3, 4.3, 1.5, 1.5, 1.8, 1.8, 0.8, 2.1, 3.8, 4.1, 6.9, 5.3, 1.1, 1.3, 2.2, 4.5, 4.1, 3.6, 3.2, 1.1, 1.1, 1.8, 3.7, 4.1, 1.6, 1.8, 3.0, 1.7, 5.3, 2.2, 1.8, 1.7, 1.6, 5.7, 4.0, 1.1, 1.6, 2.4, 5.1, 1.9, 1.5];
        
        // (cm 단위 데이터 - 단차 등이 포함됨)
        var boxCmX = ["포장상태", "건물 진입로", "건물 진입로", "건물 진입로", "건물 진입로", "건물 진입로", "건물 진입로", "기울기/단차", "기울기/단차", "건물 진입로", "건물 진입로", "기울기/단차", "건물 진입로", "기울기/단차", "기울기/단차", "건물 진입로", "건물 진입로"];
        var boxCmY = [0.1, 3.5, 5.8, 18.0, 21.0, 18.0, 4.0, 1.0, 2.1, 1.5, 14.0, 3.5, 11.5, 2.5, 3.3, 18.0, 18.0];
        
        // (도/Degree 단위 데이터 - 기울기 포함됨)
        var boxDegX = ["기울기/단차", "기울기/단차", "건물 진입로", "기울기/단차", "건물 진입로", "건물 진입로", "기울기/단차", "건물 진입로", "건물 진입로", "기울기/단차", "기울기/단차", "기울기/단차", "기울기/단차", "기울기/단차", "건물 진입로", "기울기/단차", "기울기/단차", "기울기/단차", "건물 진입로", "기울기/단차", "기울기/단차", "기울기/단차", "건물 진입로", "건물 진입로", "건물 진입로", "건물 진입로", "건물 진입로", "건물 진입로", "기울기/단차", "건물 진입로", "건물 진입로", "건물 진입로", "건물 진입로", "기울기/단차", "건물 진입로", "건물 진입로", "기울기/단차", "건물 진입로", "건물 진입로", "기울기/단차"];
        var boxDegY = [2.4, 3.6, 4.8, 2.2, 9.7, 7.9, 1.4, 7.3, 8.8, 9.2, 6.7, 3.6, 4.5, 5.4, 16.8, 7.8, 6.7, 4.5, 7.0, 9.1, 3.7, 8.0, 3.5, 3.6, 3.6, 2.7, 3.5, 1.4, 5.9, 6.6, 16.0, 7.7, 4.0, 7.6, 1.0, 2.2, 8.0, 8.6, 26.0, 10.1];

        // [수정됨] 히트맵 데이터 (실제 데이터 매핑)
        var hmX = ["개선(장기)", "긴급 조치", "긴급조치", "양호"];
        var hmY = ["건물 진입로", "기울기/단차", "유효폭", "점자블록", "포장상태"];
        var hmZ = [[23, 0, 1, 19], [8, 1, 1, 14], [0, 1, 5, 56], [2, 0, 2, 24], [0, 1, 4, 4]];

        // ==========================================
        // 2. 차트 그리기
        // ==========================================

        // 1. Bar Chart
        Plotly.newPlot('barChart', [{
            x: barX,
            y: barY,
            type: 'bar',
            marker: { color: '#5C6BC0' },
            text: barY.map(String),
            textposition: 'auto'
        }], { title: '<b>📌 항목별 점검 데이터 수</b>', margin: { t: 40, b: 40, l: 40, r: 20 } });

        // 2. Pie Chart
        Plotly.newPlot('pieChart', [{
            labels: pieLabels,
            values: pieValues,
            type: 'pie',
            hole: 0.4,
            marker: { colors: ['#66BB6A', '#FFA726', '#EF5350', '#D32F2F'] }
        }], { title: '<b>📊 전체 상태 비율</b>', margin: { t: 40, b: 20, l: 20, r: 20 } });

        // 3. Sunburst Chart
        // 데이터 구조: Total -> 상태(High Category) -> 항목(Middle Category)
        // 계층 구조도 실제 데이터 개수에 맞춰 업데이트함
        var sbLabels = ["전체", "양호", "개선(장기)", "긴급조치", "긴급 조치", "양호-유효폭", "양호-점자블록", "양호-건물진입로", "양호-기울기", "양호-포장상태", "개선-건물진입로", "개선-기울기", "개선-점자블록", "긴급조치-유효폭", "긴급조치-포장상태", "긴급조치-점자블록", "긴급조치-기울기", "긴급조치-건물진입로", "긴급 조치-유효폭", "긴급 조치-기울기", "긴급 조치-포장상태"];
        var sbParents = ["", "전체", "전체", "전체", "전체", "양호", "양호", "양호", "양호", "양호", "개선(장기)", "개선(장기)", "개선(장기)", "긴급조치", "긴급조치", "긴급조치", "긴급조치", "긴급조치", "긴급 조치", "긴급 조치", "긴급 조치"];
        var sbValues = [166, 117, 33, 13, 3, 56, 24, 19, 14, 4, 23, 8, 2, 5, 4, 2, 1, 1, 1, 1, 1];

        Plotly.newPlot('sunburstChart', [{
            type: "sunburst",
            labels: sbLabels,
            parents: sbParents,
            values: sbValues,
            branchvalues: "total",
            marker: {line: {width: 2}},
        }], {
            title: '<b>☀️ 상태별 상세 계층 구조 (Sunburst)</b>',
            margin: { t: 40, b: 10, l: 10, r: 10 }
        });

        // 4. Heatmap Chart
        Plotly.newPlot('heatmapChart', [{
            x: hmX,
            y: hmY,
            z: hmZ,
            type: 'heatmap',
            colorscale: 'Blues',
            showscale: true
        }], {
            title: '<b>🔥 항목-상태 히트맵 (집중도)</b>',
            margin: { t: 40, b: 40, l: 100, r: 20 }
        });

        // 5. Grouped Bar Chart
        var groupedTraces = [];
        var colors = {'양호': '#66BB6A', '개선(장기)': '#FFA726', '긴급조치': '#EF5350', '긴급 조치': '#D32F2F'};
        for (var status in groupedData) {
            groupedTraces.push({
                x: groupedData[status].x,
                y: groupedData[status].y,
                name: status,
                type: 'bar',
                marker: { color: colors[status] || '#999' }
            });
        }
        Plotly.newPlot('groupedBarChart', groupedTraces, {
            title: '<b>🔍 항목별 상세 상태 (양호 vs 개선)</b>',
            barmode: 'group',
            margin: { t: 40, b: 40, l: 40, r: 20 }
        });

        // 6. Histogram (유효폭 상세 분포)
        Plotly.newPlot('histogramM', [{
            x: boxMY, // 유효폭 등의 m 데이터 사용
            type: 'histogram',
            marker: { color: '#26A69A' },
            opacity: 0.7,
            xbins: { size: 0.5 } // 0.5m 단위로 묶어서 보기
        }], {
            title: '<b>📏 유효폭(m) 데이터 상세 분포 (Histogram)</b>',
            xaxis: { title: '길이 (m)' },
            yaxis: { title: '빈도수 (Count)' },
            margin: { t: 40, b: 40, l: 40, r: 20 },
            bargap: 0.05
        });

        // 7, 8, 9. Box Plots
        Plotly.newPlot('boxChartM', [{
            x: boxMX, y: boxMY, type: 'box', name: '데이터', boxpoints: 'all', jitter: 0.3, pointpos: -1.8, marker: { color: '#42A5F5' }
        }], { title: '<b>📏 길이/폭 분포 (단위: m)</b>', yaxis: { title: '미터 (m)' }, margin: { t: 40, b: 40, l: 40, r: 20 } });

        Plotly.newPlot('boxChartCm', [{
            x: boxCmX, y: boxCmY, type: 'box', name: '데이터', boxpoints: 'all', jitter: 0.3, pointpos: -1.8, marker: { color: '#AB47BC' }
        }], { title: '<b>📐 단차/높이 분포 (단위: cm)</b>', yaxis: { title: '센티미터 (cm)' }, margin: { t: 40, b: 40, l: 40, r: 20 } });

        Plotly.newPlot('boxChartDeg', [{
            x: boxDegX, y: boxDegY, type: 'box', name: '데이터', boxpoints: 'all', jitter: 0.3, pointpos: -1.8, marker: { color: '#FF7043' }
        }], { title: '<b>📐 경사/기울기 분포 (단위: 도)</b>', yaxis: { title: '각도 (Degree)' }, margin: { t: 40, b: 40, l: 40, r: 20 } });

    </script>
</body>
</html>
